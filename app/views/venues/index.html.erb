
<!-- http://www.caever.com.au/ -->
<p>What kind of magical mood do you want?</p>

  <form action="">
    <select name='mood' class="form-control1 custom-select box_size_cat">
      <option value="" selected>Mood</option>
      <% Venue::MOODS.each do |mood| %>
        <option value="<%= mood %>"><%= mood %></option>
      <% end %>
    </select>

    <input type="hidden" name="area" value="<%=params[:area]%>">

    <button type="submit">Apply</button>
  </form>



<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12 col-md-8 ">
      <div class="fixed-cards">
        <div class="row">
          <% @venues.each_with_index do |venue, index| %>
          <div class="col-xs-12 col-md-6" id="venue-<%= venue.id %>">
            <div class="stream-entry-inner" >
              <%=  link_to venue_path(venue) do %>
              <div class="stream-image" style="background-image: url(<%= cl_image_path venue.photo.path %>)">
                <div class="card_description">
                  <h4><%= venue.name %></h4>
                </div>

              </div>

              <% end %>
              <div class="border-bc">
                <div class="stream-body">
                  <div class="stream-body-description">
                    <p><%= truncate(venue.description, length: 100, separator: ' ') %></p>
                  </div>
                  <div class="stream-body-bars">
                    <div class="img_progress">
                    <div class="text-center" data-toggle="tooltip" data-placement="top" title="Hotness Level">
                      <%= image_tag 'chili.svg', class:"img_format2" %>
                    </div>
                      <div class="progress">
                        <div class="progress-bar progress-bar-success" role="progressbar" style="width: <%= venue.unicorn_score * 10 %>%" aria-valuenow="<%= venue.unicorn_score * 10 %>" aria-valuemin="0" aria-valuemax="100">
                        </div>
                      </div>
                        <span class="venue-score"><%= venue.unicorn_score %>/10</span>
                    </div>
                    <div class="img_progress">
                    <div class="text-center" data-toggle="tooltip" data-placement="top" title="Couch Comfortness Level">
                      <%= image_tag 'sofa.svg', class:"img_format2" %>
                    </div>
                      <div class="progress">
                        <div class="progress-bar progress-bar-danger" role="progressbar" style="width: <%= venue.couch_comfort * 10 %>%" aria-valuenow="<%= venue.couch_comfort * 10 %>" aria-valuemin="0" aria-valuemax="100">
                        </div>
                      </div>
                        <span class="venue-score"><%= venue.couch_comfort %>/10</span>
                    </div>
                    <div class="img_progress">
                    <div class="text-center" data-toggle="tooltip" data-placement="top" title="Noise Level">
                      <%= image_tag 'noise.svg', class:"img_format2" %>
                    </div>
                      <div class="progress">
                        <div class="progress-bar progress-bar-warning" role="progressbar" style="width: <%= venue.noise_level * 10 %>%" aria-valuenow="<%= venue.noise_level * 10 %>" aria-valuemin="0" aria-valuemax="100">
                        </div>
                      </div>
                      <span class="venue-score"><%= venue.noise_level %>/10</span>
                    </div>
                  </div>
                </div>
                <div class="stream-body2">
                  <a href="#"><i class="fa fa-instagram"></i></a>

                  <span><%= venue.area %> <%= 'Â£' * venue.price %></span>

                  <% if venue.favorite?(current_user) %>
                    <%= link_to favorite_path(venue.favorites.find_by_user_id(current_user.id)), method: :delete do %>
                    <i class="fa fa-heart"></i>
                    <% end %>
                  <% else %>
                    <%= link_to venue_favorites_path(venue), method: :post do %>
                    <i class="fa fa-heart-o"></i>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
          <% end %>
        </div>
      </div>
    </div>
    <div class="col-xs-12 col-md-4">
      <div id="map" style="width: 100%; height: 100vh;">
      </div>
    </div>
  </div>
</div>

<% content_for(:after_js) do %>
<script>
  $(document).ready(function() {
    var handler = Gmaps.build('Google');
    handler.buildMap({ internal: { id: 'map' }, provider: {styles: [{"featureType":"water","stylers":[{"visibility":"on"},{"color":"#b5cbe4"}]},{"featureType":"landscape","stylers":[{"color":"#efefef"}]},{"featureType":"road.highway","elementType":"geometry","stylers":[{"color":"#83a5b0"}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#bdcdd3"}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#ffffff"}]},{"featureType":"poi.park","elementType":"geometry","stylers":[{"color":"#e3eed3"}]},{"featureType":"administrative","stylers":[{"visibility":"on"},{"lightness":33}]},{"featureType":"road"},{"featureType":"poi.park","elementType":"labels","stylers":[{"visibility":"on"},{"lightness":20}]},{},{"featureType":"road","stylers":[{"lightness":20}]}]} }, function() {

      markers_json = <%=raw @hash.to_json %>;
      markers = _.map(markers_json, function(marker_json){
        marker = handler.addMarker(marker_json);
        _.extend(marker, marker_json);
        return marker;
      });

      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();

      for (var i = 0; i <  markers.length; ++i) {
        var marker = markers[i];
        google.maps.event.addListener(marker.serviceObject, 'click', scrollToVenue(marker, event));
      }

      function scrollToVenue(marker, event){
        return function(event){
          var venue = '#venue-' + marker.id;
          document.querySelector(venue).scrollIntoView({ behavior: 'smooth' });
          $('.stream-entry-inner').removeClass('border-gold');
          $(venue + ' .stream-entry-inner').addClass('border-gold');

        }
      }

      if (markers.length == 0) {
        handler.getMap().setZoom(2);
      } else if (markers.length == 1) {
        handler.getMap().setZoom(14);
      }
    });
  });
</script>
<% end %>

